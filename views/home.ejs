<!DOCTYPE html>
<html>
<head>
    <title>Appointment System</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

    <% if (user) { %>
        <img src="/profile/image" class="avatar-small" alt="Profile Image">
    <% } %>

    <img src="/logo.png" alt="Logo" class="logo">
    <h1>Healthcare Appointment System</h1>

    <div class="nav">
        <a href="/schedule">Schedule Appointment</a>
        <a href="/calendar">View Calendar</a>

        <% if (!user) { %>
            <a href="/login">Login</a>
        <% } else { %>
            <a href="/profile">Profile</a>
            <a href="/logout">Logout</a>
        <% } %>
    </div>

    <h2>Upcoming Appointments</h2>

    <table>
        <tr>
            <th>Patient</th>
            <th>Doctor</th>
            <th>Date & Time</th>
            <th>Action</th>
        </tr>

        <% if (appts.length === 0) { %>
            <tr><td colspan="4">No appointments yet</td></tr>
        <% } %>

        <% appts.forEach(a => { %>
        <tr>
            <td><%= a.patient %></td>
            <td><%= a.doctor %></td>

            <td>
                <% 
                    const d = new Date(a.datetime);

                    if (!isNaN(d)) {
                        const yyyy = d.getFullYear();
                        const mm = String(d.getMonth() + 1).padStart(2, "0");
                        const dd = String(d.getDate()).padStart(2, "0");

                        let hours = d.getHours();
                        const minutes = String(d.getMinutes()).padStart(2, "0");
                        const ampm = hours >= 12 ? "PM" : "AM";
                        hours = hours % 12;
                        hours = hours ? hours : 12;
                %>

                <%= `${yyyy}-${mm}-${dd} ${hours}:${minutes} ${ampm}` %>

                <% } else { %>
                    <%= a.datetime %>
                <% } %>
            </td>

            <td class="action-links">
                <a href="/edit/<%= a.id %>" class="edit">Edit</a>
                <a href="/delete/<%= a.id %>" class="delete">Delete</a>
            </td>
        </tr>
        <% }) %>
    </table>

</body>
</html>
